name: Deploy (Dev)

on:
  workflow_dispatch:
  push:
    branches:    
      - dev

jobs:
  prepare:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - run: |
          pwd
          ls ${{ github.workspace }}
  deploy:
    runs-on: ubuntu-latest
    needs: prepare
    container: 
      image: bytesmith/dbt-bigquery:latest
      env:
        DBT_ENV_SECRET_DEV_PROJECT_ID: ${{ secrets.DBT_ENV_SECRET_DEV_PROJECT_ID }}
        DBT_ENV_SECRET_DEV_KEYFILE_PRIVATE_KEY_ID: ${{ secrets.DBT_ENV_SECRET_DEV_KEYFILE_PRIVATE_KEY_ID }}
        DBT_ENV_SECRET_DEV_KEYFILE_PRIVATE_KEY: ${{ secrets.DBT_ENV_SECRET_DEV_KEYFILE_PRIVATE_KEY }}
        DBT_ENV_SECRET_DEV_KEYFILE_CLIENT_EMAIL: ${{ secrets.DBT_ENV_SECRET_DEV_KEYFILE_CLIENT_EMAIL }}
        DBT_ENV_SECRET_DEV_KEYFILE_CLIENT_ID: ${{ secrets.DBT_ENV_SECRET_DEV_KEYFILE_CLIENT_ID }}
        DBT_ENV_SECRET_DEV_KEYFILE_CLIENT_X509_CERT_URL: ${{ secrets.DBT_ENV_SECRET_DEV_KEYFILE_CLIENT_X509_CERT_URL }}
      volumes:
        - ${{ github.workspace }}/wide_world_importers_dw:/usr/app
        - ${{ github.workspace }}/dbt:/root/.dbt/
    steps:
    - name: Resolve Dependencies
    #  run: dbt deps --target dev
      run: |
        pwd
        ls /usr/app/
        ls /root/.dbt/
        ls /__w/dbt-demo/dbt-demo/
